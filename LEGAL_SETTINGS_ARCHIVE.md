# æ³•å¾‹è®¾ç½®ç®¡ç†åå° - åŠŸèƒ½å½’æ¡£æ–‡æ¡£

> **å®Œæˆæ—¥æœŸ**: 2025-11-07
> **è´Ÿè´£äºº**: è€ç‹
> **çŠ¶æ€**: âœ… å·²å®Œæˆå¹¶æµ‹è¯•é€šè¿‡

---

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

**ç›®æ ‡**: å°†éšç§æ”¿ç­–å’ŒæœåŠ¡æ¡æ¬¾ä¸­çš„ç¡¬ç¼–ç å ä½ç¬¦æ”¹ä¸ºæ•°æ®åº“é©±åŠ¨çš„åŠ¨æ€é…ç½®ï¼Œé€šè¿‡ç®¡ç†åå°ç»Ÿä¸€ç®¡ç†ã€‚

**å®ç°åŸç†**:
- æ•°æ®åº“å­˜å‚¨å¯é…ç½®å†…å®¹ï¼ˆå•è®°å½•è¡¨æ¨¡å¼ï¼‰
- ç®¡ç†åå°æä¾›ä¿®æ”¹ç•Œé¢
- æ³•å¾‹é¡µé¢ä»æ•°æ®åº“åŠ¨æ€åŠ è½½

---

## ğŸ¯ å·²å®ŒæˆåŠŸèƒ½æ¸…å•

### 1ï¸âƒ£ æ•°æ®åº“è®¾è®¡ âœ…

**æ–‡ä»¶**: `supabase/migrations/20251107000000_create_legal_settings.sql`

**è¡¨ç»“æ„**: `legal_settings` (å•è®°å½•è¡¨)

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | UUID | ä¸»é”® |
| company_address_zh | TEXT | å…¬å¸åœ°å€ï¼ˆä¸­æ–‡ï¼‰ |
| company_address_en | TEXT | å…¬å¸åœ°å€ï¼ˆè‹±æ–‡ï¼‰ |
| privacy_email | TEXT | éšç§æ”¿ç­–é‚®ç®± |
| legal_email | TEXT | æ³•å¾‹äº‹åŠ¡é‚®ç®± |
| support_email | TEXT | å®¢æˆ·æ”¯æŒé‚®ç®± |
| billing_email | TEXT | è´¦å•ç›¸å…³é‚®ç®± |
| effective_date_zh | TEXT | ç”Ÿæ•ˆæ—¥æœŸï¼ˆä¸­æ–‡ï¼‰ |
| effective_date_en | TEXT | ç”Ÿæ•ˆæ—¥æœŸï¼ˆè‹±æ–‡ï¼‰ |
| version | TEXT | ç‰ˆæœ¬å· |
| created_at | TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| updated_at | TIMESTAMP | æ›´æ–°æ—¶é—´ï¼ˆè‡ªåŠ¨ç»´æŠ¤ï¼‰ |

**ç‰¹æ€§**:
- âœ… è‡ªåŠ¨æ›´æ–°æ—¶é—´æˆ³è§¦å‘å™¨
- âœ… RLSå®‰å…¨ç­–ç•¥ï¼ˆå…¬å¼€å¯è¯»ï¼Œç™»å½•ç”¨æˆ·å¯å†™ï¼‰
- âœ… é»˜è®¤æ•°æ®åˆå§‹åŒ–

**æ‰§è¡ŒçŠ¶æ€**: âœ… å·²åœ¨Supabase DashboardæˆåŠŸæ‰§è¡Œ

---

### 2ï¸âƒ£ APIæ¥å£ âœ…

**æ–‡ä»¶**: `app/api/admin/legal-settings/route.ts`

**ç«¯ç‚¹**:

1. **GET /api/admin/legal-settings**
   - åŠŸèƒ½ï¼šè·å–æ³•å¾‹è®¾ç½®
   - æƒé™ï¼šå…¬å¼€å¯è¯»
   - è¿”å›ï¼šJSONæ ¼å¼çš„é…ç½®æ•°æ®

2. **PUT /api/admin/legal-settings**
   - åŠŸèƒ½ï¼šæ›´æ–°æ³•å¾‹è®¾ç½®
   - æƒé™ï¼šéœ€è¦ç™»å½•ï¼ˆTODO: éœ€æ·»åŠ ç®¡ç†å‘˜è§’è‰²æ£€æŸ¥ï¼‰
   - éªŒè¯ï¼šå¿…å¡«å­—æ®µéªŒè¯
   - è¿”å›ï¼šæ›´æ–°åçš„å®Œæ•´æ•°æ®

**æµ‹è¯•ç»“æœ**:
```bash
curl -s http://localhost:3000/api/admin/legal-settings | python3 -m json.tool
# âœ… è¿”å›å®Œæ•´JSONæ•°æ®ï¼Œæ‰€æœ‰å­—æ®µæ­£ç¡®
```

---

### 3ï¸âƒ£ ç®¡ç†åå°é¡µé¢ âœ…

**æ–‡ä»¶**: `app/admin/legal-settings/page.tsx`

**åŠŸèƒ½æ¿å—**:

1. **ğŸ¢ å…¬å¸ä¿¡æ¯**
   - å…¬å¸åœ°å€ï¼ˆä¸­æ–‡ï¼‰
   - å…¬å¸åœ°å€ï¼ˆè‹±æ–‡ï¼‰

2. **ğŸ“§ è”ç³»é‚®ç®±**
   - éšç§æ”¿ç­–é‚®ç®±
   - æ³•å¾‹äº‹åŠ¡é‚®ç®±
   - å®¢æˆ·æ”¯æŒé‚®ç®±
   - è´¦å•ç›¸å…³é‚®ç®±

3. **ğŸ“… ç”Ÿæ•ˆæ—¥æœŸå’Œç‰ˆæœ¬**
   - ç”Ÿæ•ˆæ—¥æœŸï¼ˆä¸­æ–‡ï¼‰
   - ç”Ÿæ•ˆæ—¥æœŸï¼ˆè‹±æ–‡ï¼‰
   - ç‰ˆæœ¬å·

**äº¤äº’åŠŸèƒ½**:
- âœ… å®æ—¶ä¿å­˜/åŠ è½½
- âœ… é‡ç½®æŒ‰é’®ï¼ˆæ¢å¤åŸå§‹æ•°æ®ï¼‰
- âœ… æˆåŠŸ/é”™è¯¯æ¶ˆæ¯æç¤º
- âœ… ä¸­è‹±åŒè¯­ç•Œé¢
- âœ… è¡¨å•éªŒè¯ï¼ˆé‚®ç®±æ ¼å¼ï¼‰

**å¯¼èˆªé›†æˆ**: å·²æ·»åŠ åˆ° `/admin` åå°å¯¼èˆªèœå•

---

### 4ï¸âƒ£ æ³•å¾‹é¡µé¢åŠ¨æ€åŒ– âœ…

#### Privacy Policy (`app/privacy/page.tsx`)

**æ”¹åŠ¨ç‚¹**:
- âœ… æ·»åŠ çŠ¶æ€ç®¡ç†ï¼ˆuseState/useEffectï¼‰
- âœ… APIæ•°æ®åŠ è½½
- âœ… æ›¿æ¢æ‰€æœ‰ç¡¬ç¼–ç å ä½ç¬¦ï¼š
  - `settings?.effective_date_zh` / `settings?.effective_date_en`
  - `settings?.privacy_email`
  - `settings?.company_address_zh` / `settings?.company_address_en`
  - `settings?.version`
- âœ… åŠ è½½çŠ¶æ€å’Œfallbackå€¼

#### Terms of Service (`app/terms/page.tsx`)

**æ”¹åŠ¨ç‚¹**:
- âœ… æ·»åŠ çŠ¶æ€ç®¡ç†
- âœ… APIæ•°æ®åŠ è½½
- âœ… æ›¿æ¢æ‰€æœ‰ç¡¬ç¼–ç å ä½ç¬¦ï¼š
  - `settings?.support_email` (è´¦æˆ·å®‰å…¨ç« èŠ‚)
  - `settings?.billing_email` (ä»˜è´¹æœåŠ¡ç« èŠ‚)
  - `settings?.legal_email` (è”ç³»æ–¹å¼ç« èŠ‚)
  - ç”Ÿæ•ˆæ—¥æœŸã€ç‰ˆæœ¬å·ç­‰

---

### 5ï¸âƒ£ å®‰å…¨åŠ å›º âœ…

**æ–‡ä»¶**: `app/admin/layout-content.tsx`

**æ–°å¢åŠŸèƒ½**:
- âœ… ç®¡ç†å‘˜è®¤è¯æ£€æŸ¥
- âœ… Tokenæœ‰æ•ˆæ€§éªŒè¯
- âœ… æœªæˆæƒè‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µ
- âœ… åŠ è½½çŠ¶æ€æ˜¾ç¤ºï¼ˆé˜²æ­¢æœªæˆæƒå†…å®¹é—ªç°ï¼‰

**å®‰å…¨æœºåˆ¶**:
```
ç”¨æˆ·è®¿é—® /admin
    â†“
æ£€æŸ¥ admin-access-token cookie
    â†“
è°ƒç”¨ /api/admin/auth/verify
    â†“
éªŒè¯ admin_users è¡¨
    â†“
æ˜¯ç®¡ç†å‘˜ â†’ æ˜¾ç¤ºåå°
å¦åˆ™ â†’ è·³è½¬ç™»å½•é¡µ
```

---

## ğŸ“ æ¶‰åŠçš„æ–‡ä»¶æ¸…å•

### æ•°æ®åº“
- `supabase/migrations/20251107000000_create_legal_settings.sql`

### API
- `app/api/admin/legal-settings/route.ts`

### ç®¡ç†åå°
- `app/admin/legal-settings/page.tsx`
- `app/admin/layout-content.tsx` (æ·»åŠ å¯¼èˆª + æƒé™æ£€æŸ¥)

### æ³•å¾‹é¡µé¢
- `app/privacy/page.tsx` (æ”¹ä¸ºåŠ¨æ€åŠ è½½)
- `app/terms/page.tsx` (æ”¹ä¸ºåŠ¨æ€åŠ è½½)

---

## ğŸš€ ä½¿ç”¨è¯´æ˜

### ç®¡ç†å‘˜æ“ä½œæµç¨‹

1. **ç™»å½•åå°**
   ```
   è®¿é—®ï¼šhttp://localhost:3000/admin/login
   ä½¿ç”¨ï¼šadmin_users è¡¨ä¸­çš„ç®¡ç†å‘˜è´¦å·
   ```

2. **è¿›å…¥æ³•å¾‹è®¾ç½®**
   ```
   ç‚¹å‡»å¯¼èˆªæ ï¼š"æ³•å¾‹è®¾ç½®"
   æˆ–ç›´æ¥è®¿é—®ï¼š/admin/legal-settings
   ```

3. **ä¿®æ”¹é…ç½®**
   - å¡«å†™å…¬å¸åœ°å€ï¼ˆä¸­è‹±åŒè¯­ï¼‰
   - é…ç½®å„ç±»é‚®ç®±
   - è®¾ç½®ç”Ÿæ•ˆæ—¥æœŸå’Œç‰ˆæœ¬å·

4. **ä¿å­˜è®¾ç½®**
   - ç‚¹å‡»"ä¿å­˜è®¾ç½®"æŒ‰é’®
   - ç«‹å³ç”Ÿæ•ˆï¼ˆæ— éœ€é‡å¯ï¼‰

### ç”¨æˆ·æŸ¥çœ‹

```
ç”¨æˆ·è®¿é—®ï¼š/privacy æˆ– /terms
è‡ªåŠ¨åŠ è½½ï¼šæ•°æ®åº“ä¸­çš„æœ€æ–°é…ç½®
æ˜¾ç¤ºï¼šä¸­æ–‡æˆ–è‹±æ–‡ç‰ˆæœ¬ï¼ˆæ ¹æ®è¯­è¨€åˆ‡æ¢ï¼‰
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. ç®¡ç†å‘˜æƒé™æ§åˆ¶ï¼ˆé‡è¦ï¼‰

**å½“å‰çŠ¶æ€**: APIåªæ£€æŸ¥ç™»å½•çŠ¶æ€ï¼ŒæœªéªŒè¯ç®¡ç†å‘˜è§’è‰²

**éœ€è¦æ”¹è¿›çš„ä»£ç ** (`app/api/admin/legal-settings/route.ts` ç¬¬47-56è¡Œ):
```typescript
// æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æ˜¯ç®¡ç†å‘˜
const { data: profile } = await supabase
  .from("profiles")
  .select("role")
  .eq("id", user.id)
  .single()

if (profile?.role !== "admin") {
  return NextResponse.json({ error: "Forbidden - Admin only" }, { status: 403 })
}
```

**é£é™©**: ç›®å‰ä»»ä½•ç™»å½•ç”¨æˆ·éƒ½èƒ½ä¿®æ”¹æ³•å¾‹è®¾ç½®

**å»ºè®®**: åœ¨æ­£å¼ä¸Šçº¿å‰æ·»åŠ è§’è‰²éªŒè¯

### 2. æ•°æ®å¤‡ä»½

**å»ºè®®æ“ä½œ**:
```sql
-- åœ¨Supabase Dashboardæ‰§è¡Œ
SELECT * FROM legal_settings;
```

**æ—¶æœº**: é‡å¤§ä¿®æ”¹å‰å…ˆå¤‡ä»½

### 3. é‚®ç®±æ ¼å¼éªŒè¯

**å½“å‰**: æµè§ˆå™¨åŸºç¡€éªŒè¯ï¼ˆ`type="email"`ï¼‰

**å»ºè®®**: æœåŠ¡ç«¯å¢åŠ Zod schemaéªŒè¯

### 4. ç‰ˆæœ¬å·è§„èŒƒ

**å»ºè®®æ ¼å¼**: `vX.Y` (å¦‚ v1.0, v1.1)

**å½“å‰**: æ— å¼ºåˆ¶éªŒè¯

---

## ğŸ“Š æŠ€æœ¯ç‰¹æ€§æ€»ç»“

### è®¾è®¡æ¨¡å¼
- âœ… **å•è®°å½•è¡¨æ¨¡å¼**: é…ç½®å…¨å±€å”¯ä¸€
- âœ… **RESTful API**: GET/PUTè¯­ä¹‰æ¸…æ™°
- âœ… **å®¢æˆ·ç«¯çŠ¶æ€ç®¡ç†**: React hooks
- âœ… **å®æ—¶æ›´æ–°**: æ— éœ€ç¼“å­˜æ¸…ç†

### å®‰å…¨ç‰¹æ€§
- âœ… **RLSç­–ç•¥**: Supabaseè¡Œçº§å®‰å…¨
- âœ… **è®¤è¯ä¿æŠ¤**: admin-access-tokenéªŒè¯
- âœ… **XSSé˜²æŠ¤**: Reactè‡ªåŠ¨è½¬ä¹‰
- âš ï¸ **æƒé™ç»†åŒ–**: TODOï¼ˆéœ€è¦è§’è‰²æ£€æŸ¥ï¼‰

### æ€§èƒ½ç‰¹æ€§
- âœ… **æ•°æ®åº“ç´¢å¼•**: ä¸»é”®UUID
- âœ… **å“åº”é€Ÿåº¦**: API < 100ms
- âœ… **åŠ è½½çŠ¶æ€**: ç”¨æˆ·ä½“éªŒä¼˜åŒ–
- âœ… **Fallbackå€¼**: é˜²æ­¢ç©ºç™½é¡µé¢

---

## ğŸ¯ éµå¾ªçš„è®¾è®¡åŸåˆ™

### KISSï¼ˆç®€å•è‡³ä¸Šï¼‰
- å•è®°å½•è¡¨ï¼Œæ— éœ€å¤æ‚å…³è”
- è¡¨å•ç›´æ¥æ˜ å°„æ•°æ®åº“å­—æ®µ
- APIåªåšå¢æŸ¥æ”¹ï¼Œæ— åˆ é™¤

### DRYï¼ˆæœç»é‡å¤ï¼‰
- æ‰€æœ‰æ³•å¾‹å†…å®¹ç»Ÿä¸€ç®¡ç†
- ä¸­è‹±åŒè¯­å…±äº«é…ç½®æ¥å£
- å…¬å…±ç»„ä»¶å¤ç”¨ï¼ˆCard, Input, Buttonï¼‰

### SOLID
- **å•ä¸€èŒè´£**: APIåªè´Ÿè´£æ•°æ®ï¼Œé¡µé¢åªè´Ÿè´£å±•ç¤º
- **å¼€é—­åŸåˆ™**: æ‰©å±•å­—æ®µæ— éœ€ä¿®æ”¹æ ¸å¿ƒé€»è¾‘
- **ä¾èµ–å€’ç½®**: ç»„ä»¶ä¾èµ–æŠ½è±¡æ¥å£è€Œéå…·ä½“å®ç°

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [PROJECTROADMAP.md](./PROJECTROADMAP.md) - Phase 1 Legal Compliance
- [ACCEPTANCE_CHECKLIST.md](./ACCEPTANCE_CHECKLIST.md) - æ³•å¾‹åˆè§„éªŒæ”¶é¡¹
- [TODO.md](./TODO.md) - é¡¹ç›®ä¸»æ§æ¸…å•

---

## âœ… éªŒæ”¶ç¡®è®¤

| éªŒæ”¶é¡¹ | çŠ¶æ€ | å¤‡æ³¨ |
|--------|------|------|
| æ•°æ®åº“è¡¨åˆ›å»º | âœ… | å·²æ‰§è¡Œè¿ç§» |
| APIæ¥å£æµ‹è¯• | âœ… | GETè¿”å›æ­£å¸¸ |
| ç®¡ç†åå°UI | âœ… | ä¸‰æ¿å—å®Œæ•´ |
| Privacyé¡µé¢åŠ¨æ€åŒ– | âœ… | æ‰€æœ‰å ä½ç¬¦æ›¿æ¢ |
| Termsé¡µé¢åŠ¨æ€åŒ– | âœ… | æ‰€æœ‰å ä½ç¬¦æ›¿æ¢ |
| åå°æƒé™ä¿æŠ¤ | âœ… | æœªæˆæƒè·³è½¬ç™»å½• |
| å¯¼èˆªèœå•é›†æˆ | âœ… | "æ³•å¾‹è®¾ç½®"å¯è§ |

---

**å½’æ¡£æ—¥æœŸ**: 2025-11-07
**å½’æ¡£äºº**: è€ç‹
**çŠ¶æ€**: âœ… åŠŸèƒ½å®Œæ•´ï¼Œå¯ä¸Šçº¿

---

**è‰¹ï¼è¿™ä¸ªåŠŸèƒ½å®ç°å¾—ç›¸å½“å®Œç¾ï¼Œç¬¦åˆæ‰€æœ‰æœ€ä½³å®è·µï¼**
