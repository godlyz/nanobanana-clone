# ğŸ¯ ä¼˜å…ˆä»»åŠ¡æ¸…å•

åŸºäºä»£ç å®¡è®¡æŠ¥å‘Š,æŒ‰ä¼˜å…ˆçº§æ’åºçš„å¾…åŠäº‹é¡¹ã€‚

---

## ğŸ”´ P0 - ç”Ÿäº§é˜»å¡ (å¿…é¡»ç«‹å³ä¿®å¤)

### 1. åˆ é™¤é‡å¤çš„ pricing é¡µé¢
- [ ] åˆ é™¤ `app/pricing/page_new.tsx`
- [ ] ç¡®è®¤ `app/pricing/page.tsx` åŠŸèƒ½å®Œæ•´
- **é¢„è®¡æ—¶é—´**: 30 åˆ†é’Ÿ

### 2. ç§»é™¤æ„å»ºé”™è¯¯å¿½ç•¥é…ç½®
- [ ] ç¼–è¾‘ `next.config.mjs`,åˆ é™¤ `ignoreBuildErrors` å’Œ `ignoreDuringBuilds`
- [ ] è¿è¡Œ `pnpm build` æ£€æŸ¥æ‰€æœ‰é”™è¯¯
- [ ] ä¿®å¤æ‰€æœ‰ TypeScript å’Œ ESLint é”™è¯¯
- **é¢„è®¡æ—¶é—´**: 1 å°æ—¶

### 3. å®ç° Webhook å¤„ç†é€»è¾‘
- [ ] `app/api/webhooks/creem/route.ts` - å®ç° 6 ä¸ªå¤„ç†å™¨
  - `handleCheckoutCompleted` - æ”¯ä»˜æˆåŠŸ
  - `handleCheckoutExpired` - æ”¯ä»˜è¿‡æœŸ
  - `handleSubscriptionCreated` - è®¢é˜…åˆ›å»º
  - `handleSubscriptionUpdated` - è®¢é˜…æ›´æ–°
  - `handleSubscriptionCancelled` - è®¢é˜…å–æ¶ˆ
  - `handleRefundIssued` - é€€æ¬¾å¤„ç†
- [ ] æ·»åŠ  Supabase æ•°æ®åº“æ“ä½œ
- [ ] æ·»åŠ é‚®ä»¶é€šçŸ¥
- **é¢„è®¡æ—¶é—´**: 8 å°æ—¶

### 4. æ·»åŠ  API è®¤è¯
- [ ] åˆ›å»º `lib/api-auth.ts` - è®¤è¯ä¸­é—´ä»¶
- [ ] ä¸ºä»¥ä¸‹ API æ·»åŠ è®¤è¯:
  - `/api/generate` âœ…
  - `/api/batch-generate` âœ…
  - `/api/smart-prompt/optimize` âœ…
  - `/api/credits/purchase` âœ…
- [ ] æ·»åŠ ç”¨æˆ·é¢åº¦æ£€æŸ¥
- **é¢„è®¡æ—¶é—´**: 4 å°æ—¶

### 5. æ”¯ä»˜éªŒè¯ç­¾åå®ç°
- [ ] `app/api/payment/verify/route.ts` - å®ç° Creem ç­¾åéªŒè¯
- [ ] è”ç³» Creem æ”¯æŒç¡®è®¤éªŒè¯ç®—æ³•
- [ ] æ·»åŠ å®Œæ•´çš„ä¸šåŠ¡é€»è¾‘
- **é¢„è®¡æ—¶é—´**: 4 å°æ—¶

**P0 æ€»è®¡**: ~18 å°æ—¶ (2.25 å·¥ä½œæ—¥)

---

## ğŸŸ  P1 - é«˜ä¼˜å…ˆçº§ (æœ¬å‘¨å®Œæˆ)

### 1. ä¿®å¤ 20 ä¸ª `any` ç±»å‹
**æ–‡ä»¶æ¸…å•**:
- [ ] `app/api/generate/route.ts:35` - `let contents: any`
- [ ] `app/api/webhooks/creem/route.ts:13,96` - Webhook æ•°æ®ç±»å‹
- [ ] `middleware.ts:3` - Request ç±»å‹
- [ ] `lib/smart-prompt-analyzer.ts:44` - userPreferences ç±»å‹

**æ”¹è¿›æ–¹æ¡ˆ**:
```typescript
// å®šä¹‰ç²¾ç¡®çš„æ¥å£ç±»å‹
interface ContentPart {
  text?: string
  inlineData?: { mimeType: string; data: string }
}

interface WebhookEvent {
  type: string
  data: Record<string, unknown>
}

type Request = NextRequest
```
- **é¢„è®¡æ—¶é—´**: 4 å°æ—¶

### 2. æ›¿æ¢ä¸å®‰å…¨çš„éšæœºæ•°ç”Ÿæˆ
**æ–‡ä»¶æ¸…å•** (6 å¤„):
- [ ] `app/api/generate/route.ts:138`
- [ ] `app/api/scenes/route.ts`
- [ ] `app/api/subjects/route.ts`
- [ ] `app/api/history/route.ts`
- [ ] `app/api/generate/chat/route.ts`
- [ ] `app/api/credits/purchase/route.ts`

**æ›¿æ¢ä¸º**:
```typescript
import { randomUUID } from 'crypto'
const randomId = randomUUID()
```
- **é¢„è®¡æ—¶é—´**: 2 å°æ—¶

### 3. å®ç°é€Ÿç‡é™åˆ¶
- [ ] å®‰è£… `@upstash/ratelimit` å’Œ `@upstash/redis`
- [ ] åˆ›å»º `lib/rate-limit.ts`
- [ ] ä¸ºé«˜æˆæœ¬ API æ·»åŠ é™åˆ¶:
  - `/api/generate` - 10 æ¬¡/åˆ†é’Ÿ
  - `/api/batch-generate` - 3 æ¬¡/åˆ†é’Ÿ
  - é€šç”¨ API - 100 æ¬¡/åˆ†é’Ÿ
- **é¢„è®¡æ—¶é—´**: 6 å°æ—¶

### 4. è·å–çœŸå®ç”¨æˆ·ä¿¡æ¯
- [ ] `app/api/checkout/route.ts:51` - æ›¿æ¢ç¡¬ç¼–ç çš„ "anonymous"
- [ ] ä» Supabase session è·å– user.id
- [ ] æ·»åŠ æœªç™»å½•ç”¨æˆ·çš„å¤„ç†é€»è¾‘
- **é¢„è®¡æ—¶é—´**: 2 å°æ—¶

**P1 æ€»è®¡**: ~14 å°æ—¶ (1.75 å·¥ä½œæ—¥)

---

## ğŸŸ¡ P2 - ä¸­ç­‰ä¼˜å…ˆçº§ (æœ¬æœˆå®Œæˆ)

### 1. æå–å·¥å…·é¡µé¢é€šç”¨ç»„ä»¶
- [ ] åˆ›å»º `components/ToolRedirect.tsx`
- [ ] é‡æ„ 7 ä¸ªå·¥å…·é¡µé¢:
  - `app/tools/one-shot/page.tsx`
  - `app/tools/background-remover/page.tsx`
  - `app/tools/character-consistency/page.tsx`
  - `app/tools/scene-preservation/page.tsx`
  - `app/tools/text-to-image-with-text/page.tsx`
  - `app/tools/chat-edit/page.tsx`
  - `app/tools/smart-prompt/page.tsx`
- **èŠ‚çœä»£ç **: ~150 è¡Œ
- **é¢„è®¡æ—¶é—´**: 2 å°æ—¶

### 2. ç»Ÿä¸€é”™è¯¯å¤„ç†
- [ ] åˆ›å»º `lib/api-error-handler.ts`
- [ ] å®šä¹‰ç»Ÿä¸€çš„ API å“åº”æ ¼å¼
- [ ] é‡æ„æ‰€æœ‰ API è·¯ç”±ä½¿ç”¨æ–°çš„é”™è¯¯å¤„ç†å™¨
- **é¢„è®¡æ—¶é—´**: 4 å°æ—¶

### 3. åˆ›å»ºç¯å¢ƒå˜é‡éªŒè¯å™¨
- [ ] åˆ›å»º `lib/env-validator.ts`
- [ ] å®šä¹‰ `validateEnvVar()` å‡½æ•°
- [ ] é‡æ„æ‰€æœ‰ç¯å¢ƒå˜é‡æ£€æŸ¥
- **é¢„è®¡æ—¶é—´**: 2 å°æ—¶

### 4. é‡æ„ç¼–è¾‘å™¨çŠ¶æ€ç®¡ç†
- [ ] å®šä¹‰ `EditorState` æ¥å£
- [ ] åˆ›å»º `editorReducer`
- [ ] å°† 15+ ä¸ª useState åˆå¹¶ä¸º useReducer
- [ ] æµ‹è¯•åŠŸèƒ½å®Œæ•´æ€§
- **é¢„è®¡æ—¶é—´**: 8 å°æ—¶

### 5. å®Œå–„è¾“å…¥éªŒè¯
- [ ] ä¸ºæ‰€æœ‰ API åˆ›å»º Zod schema
- [ ] æ·»åŠ æ·±åº¦éªŒè¯ (é•¿åº¦ã€æ ¼å¼ã€èŒƒå›´)
- [ ] ç»Ÿä¸€éªŒè¯é”™è¯¯å“åº”
- **é¢„è®¡æ—¶é—´**: 4 å°æ—¶

### 6. è§„èŒƒæ—¥å¿—ç³»ç»Ÿ
- [ ] åˆ›å»º `lib/logger.ts`
- [ ] æ›¿æ¢æ‰€æœ‰ console.log
- [ ] æ·»åŠ æ—¥å¿—çº§åˆ«æ§åˆ¶
- **é¢„è®¡æ—¶é—´**: 4 å°æ—¶

### 7. å›¾åƒå¤„ç†ä¼˜åŒ–
- [ ] æ·»åŠ å›¾åƒå‹ç¼© (`browser-image-compression`)
- [ ] å®ç° Web Worker å¤„ç†å¤§å›¾
- [ ] æ·»åŠ ä¸Šä¼ è¿›åº¦æ˜¾ç¤º
- **é¢„è®¡æ—¶é—´**: 6 å°æ—¶

**P2 æ€»è®¡**: ~30 å°æ—¶ (3.75 å·¥ä½œæ—¥)

---

## ğŸŸ¢ P3 - ä½ä¼˜å…ˆçº§ (æœ‰æ—¶é—´å†åš)

### 1. é…ç½®æµ‹è¯•æ¡†æ¶
- [ ] å®‰è£… Jest + React Testing Library
- [ ] é…ç½® `jest.config.js`
- [ ] ç¼–å†™æ ¸å¿ƒå·¥å…·å‡½æ•°æµ‹è¯•
- [ ] ç¼–å†™ç»„ä»¶å•å…ƒæµ‹è¯•
- **é¢„è®¡æ—¶é—´**: 8 å°æ—¶

### 2. E2E æµ‹è¯•
- [ ] å®‰è£… Playwright
- [ ] ç¼–å†™ä¸»è¦ç”¨æˆ·æµç¨‹æµ‹è¯•:
  - æ³¨å†Œ/ç™»å½•
  - å›¾åƒç”Ÿæˆ
  - æ”¯ä»˜æµç¨‹
- **é¢„è®¡æ—¶é—´**: 8 å°æ—¶

### 3. ä»£ç åˆ†å‰²å’Œæ‡’åŠ è½½
- [ ] ä½¿ç”¨ `next/dynamic` æ‡’åŠ è½½ç¼–è¾‘å™¨ç»„ä»¶
- [ ] åˆ†æ bundle size
- [ ] ä¼˜åŒ–é¦–å±åŠ è½½æ€§èƒ½
- **é¢„è®¡æ—¶é—´**: 4 å°æ—¶

### 4. API æ–‡æ¡£
- [ ] å®‰è£… Swagger/OpenAPI å·¥å…·
- [ ] ä¸ºæ‰€æœ‰ API ç«¯ç‚¹ç¼–å†™æ–‡æ¡£
- [ ] éƒ¨ç½² API æ–‡æ¡£é¡µé¢
- **é¢„è®¡æ—¶é—´**: 8 å°æ—¶

### 5. æ€§èƒ½ç›‘æ§
- [ ] é›†æˆ Sentry é”™è¯¯è¿½è¸ª
- [ ] æ·»åŠ æ€§èƒ½æŒ‡æ ‡æ”¶é›†
- [ ] é…ç½®å‘Šè­¦è§„åˆ™
- **é¢„è®¡æ—¶é—´**: 4 å°æ—¶

**P3 æ€»è®¡**: ~32 å°æ—¶ (4 å·¥ä½œæ—¥)

---

## ğŸ“Š æ—¶é—´ä¼°ç®—æ€»è§ˆ

| ä¼˜å…ˆçº§ | ä»»åŠ¡æ•° | é¢„è®¡æ—¶é—´ | å·¥ä½œæ—¥ |
|--------|--------|----------|--------|
| P0 (å¿…é¡») | 5 | 18 å°æ—¶ | 2.25 å¤© |
| P1 (é«˜) | 4 | 14 å°æ—¶ | 1.75 å¤© |
| P2 (ä¸­) | 7 | 30 å°æ—¶ | 3.75 å¤© |
| P3 (ä½) | 5 | 32 å°æ—¶ | 4.00 å¤© |
| **æ€»è®¡** | **21** | **94 å°æ—¶** | **11.75 å¤©** |

> æŒ‰æ¯å¤© 8 å°æ—¶å·¥ä½œæ—¶é—´è®¡ç®—

---

## ğŸ¯ æœ¬å‘¨ç›®æ ‡ (Week 1)

**ç›®æ ‡**: å®Œæˆæ‰€æœ‰ P0 å’Œ P1 ä»»åŠ¡

### Day 1-2: P0 ä»»åŠ¡
- [x] åˆ é™¤é‡å¤é¡µé¢
- [x] ç§»é™¤æ„å»ºé”™è¯¯å¿½ç•¥
- [ ] å®ç° Webhook å¤„ç†é€»è¾‘ (éƒ¨åˆ†)

### Day 3-4: P0 + P1 ä»»åŠ¡
- [ ] å®Œæˆ Webhook å¤„ç†é€»è¾‘
- [ ] æ·»åŠ  API è®¤è¯
- [ ] ä¿®å¤ `any` ç±»å‹

### Day 5: P1 ä»»åŠ¡
- [ ] æ›¿æ¢éšæœºæ•°ç”Ÿæˆ
- [ ] å®ç°é€Ÿç‡é™åˆ¶
- [ ] è·å–çœŸå®ç”¨æˆ·ä¿¡æ¯

---

## ğŸ“ å®Œæˆæ£€æŸ¥æ¸…å•

### æ¯ä¸ªä»»åŠ¡å®Œæˆå:
- [ ] ä»£ç å®¡æŸ¥ (è‡ªæŸ¥)
- [ ] åŠŸèƒ½æµ‹è¯•
- [ ] æ›´æ–°ç›¸å…³æ–‡æ¡£
- [ ] Git commit (ä½¿ç”¨è§„èŒƒçš„ commit message)

### æ¯å‘¨å®Œæˆå:
- [ ] æ›´æ–° `CODE_AUDIT_REPORT.md`
- [ ] æ›´æ–°æ­¤ä»»åŠ¡æ¸…å•
- [ ] ä¸å›¢é˜ŸåŒæ­¥è¿›åº¦

---

**åˆ›å»ºæ—¶é—´**: 2025-10-22
**è´Ÿè´£äºº**: å¼€å‘å›¢é˜Ÿ
**å®¡æ ¸äºº**: æŠ€æœ¯è´Ÿè´£äºº
